<!DOCTYPE html>
<html>
<head>
  <title>Carrom Rating Calculator</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    input { width: 80px; padding: 4px; }
    button { padding: 10px 15px; margin-top: 15px; }
    .result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>

<h2>Carrom Rating Calculator</h2>

<h3>Initial Ratings</h3>
Player 1 Rating:
<input type="number" id="initialR1">
Player 2 Rating:
<input type="number" id="initialR2">

<h3>Match Results (5 Rows)</h3>

<table>
  <tr>
    <th>Row</th>
    <th>Player 1 Score</th>
    <th>Player 2 Score</th>
    <th># Boards</th>
    <th>New Rating Player1</th>
    <th>New Rating Player2</th>
  </tr>
  <tbody id="matchRows"></tbody>
</table>

<button onclick="calculate()">Calculate Rating</button>

<div class="result" id="finalResult"></div>

<script>
const F = 400;
const P = 5;

// Create 5 empty rows
for (let i = 1; i <= 5; i++) {
  let row = `
    <tr>
      <td>${i}</td>
      <td><input type="number" id="s1_${i}"></td>
      <td><input type="number" id="s2_${i}"></td>
      <td><input type="number" id="nb_${i}"></td>
      <td id="r1_${i}">-</td>
      <td id="r2_${i}">-</td>
    </tr>
  `;
  document.getElementById("matchRows").innerHTML += row;
}

function calculate() {

  let r1 = parseFloat(document.getElementById("initialR1").value);
  let r2 = parseFloat(document.getElementById("initialR2").value);

  if (isNaN(r1) || isNaN(r2)) {
    alert("Please enter initial ratings for both players.");
    return;
  }

  for (let i = 1; i <= 5; i++) {

    let s1 = parseFloat(document.getElementById("s1_" + i).value);
    let s2 = parseFloat(document.getElementById("s2_" + i).value);
    let Nb = parseFloat(document.getElementById("nb_" + i).value);

    if (isNaN(s1) || isNaN(s2) || isNaN(Nb)) {
      continue; // Skip empty rows
    }

    let S = s1 - s2;
    let D = r1 - r2;

    // Equation 1
    let Sw = Math.sign(S) * Math.abs(S) *
      (1 + 0.3 *
      ((Math.pow(10, (Math.abs(S)/Nb - P)) - 1) /
       (Math.pow(10, (Math.abs(S)/Nb - P)) + 1)));

    // Equation 2
    let expected = 25 - (50 / (1 + Math.pow(10, D / F)));
    let Cr = Sw - expected;

    r1 = Math.round(r1 + Cr);
    r2 = Math.round(r2 - Cr);

    document.getElementById("r1_" + i).innerText = r1;
    document.getElementById("r2_" + i).innerText = r2;
  }

  document.getElementById("finalResult").innerHTML =
    "Final Ratings â†’ Player 1: " + r1 +
    " | Player 2: " + r2;
}
</script>

</body>
</html>

